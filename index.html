<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bản đồ Việt Nam (GeoJSON + Leaflet)</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <style>
    html, body { height: 100%; margin: 0; }
    #map { height: 100%; background: #eef2ff; } /* nền nhẹ, không tile */
    .leaflet-tooltip.tooltip-name {
      background: rgba(0,0,0,0.7);
      color: #fff;
      border: none;
      box-shadow: none;
      font-weight: 600;
      padding: 4px 8px;
      border-radius: 4px;
    }
    .map-legend {
      position: absolute; z-index: 1000; right: 12px; bottom: 12px;
      background: #fff; border-radius: 8px; padding: 8px 10px; box-shadow: 0 2px 10px rgba(0,0,0,.1);
      font: 14px/1.2 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
    }
    .chip { display:inline-block; width:14px; height:14px; border-radius:2px; margin-right:6px; vertical-align:middle; }
  </style>
</head>
<body>
  <div id="map"></div>
  <div class="map-legend">
    <div><span class="chip" style="background:#93c5fd"></span>Khu vực tỉnh/thành</div>
    <div><span class="chip" style="background:#60a5fa"></span>Hover để nổi bật</div>
    <div>Double-click để xem popup & zoom</div>
  </div>

  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>
  <script>
    // Khởi tạo bản đồ không có tile nền
    const map = L.map('map', {
      zoomControl: true,
      scrollWheelZoom: true
    });

    // Tắt double-click zoom để dành cho popup + fitBounds
    map.doubleClickZoom.disable();

    // Tải GeoJSON Việt Nam
    fetch('vn_geo.json')
      .then(res => res.json())
      .then(geo => {
        const baseStyle = {
          color: '#1f2937',     // viền
          weight: 1,
          fillColor: '#93c5fd', // màu nền tỉnh
          fillOpacity: 0.35
        };

        const layer = L.geoJSON(geo, {
          style: () => baseStyle,
          onEachFeature: (feature, lyr) => {
            // Tooltip tên tỉnh
            const pname = feature?.properties?.name || '';
            if (pname) {
              lyr.bindTooltip(pname, { sticky: true, direction: 'center', className: 'tooltip-name' });
            }

            // Hiệu ứng hover
            lyr.on('mouseover', (e) => {
              e.target.setStyle({ weight: 2, fillOpacity: 0.55, fillColor: '#60a5fa' });
              // giữ tooltip hiện giữa đa giác
              if (!e.target.isTooltipOpen()) e.target.openTooltip(e.latlng);
            });
            lyr.on('mouseout', (e) => {
              layer.resetStyle(e.target);
              e.target.closeTooltip();
            });

            // Double-click: hiện popup + zoom vào tỉnh
            lyr.on('dblclick', (e) => {
              const p = feature.properties || {};
              const html = `
                <div style="min-width:220px;font:14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif">
                  <div style="font-weight:700;font-size:16px;margin-bottom:6px">${p.Name ?? 'Không rõ'}</div>
                  ${p.oldName ? `<div><b>Tên cũ:</b> ${p.oldName}</div>` : ''}
                  ${p.slug ? `<div><b>Slug:</b> ${p.slug}</div>` : ''}
                  ${p.id_1 != null ? `<div><b>ID:</b> ${p.id_1}</div>` : ''}
                </div>
              `;
              L.popup({ maxWidth: 320 })
                .setLatLng(e.latlng)
                .setContent(html)
                .openOn(map);

              map.fitBounds(e.target.getBounds(), { maxZoom: 8, animate: true });
              L.DomEvent.stop(e); // chặn lan truyền để không kích hoạt hành vi khác
            });
          }
        }).addTo(map);

        // Giới hạn khung nhìn trong phạm vi Việt Nam
        const vnBounds = layer.getBounds();
        map.fitBounds(vnBounds, { animate: false });
        map.setMaxBounds(vnBounds.pad(0.1)); // cho phép kéo ra một chút
      })
      .catch(err => {
        console.error('Không thể tải vn_geo.json', err);
        alert('Không thể tải dữ liệu bản đồ (vn_geo.json). Hãy kiểm tra đường dẫn và chạy qua web server.');
      });
  </script>
</body>
</html>
